description: >
  Accuknox Container Scan
parameters:
  IMAGE_NAME:
    description: "Docker image name"
    type: string
  TAG:
    description: "Docker image tag name"
    type: string
  IMAGE_TAR:
    description: "Docker image tar file in the artifact"
    type: string
  SEVERITY:
    description: "Comma-separated severities: UNKNOWN,LOW,MEDIUM,HIGH,CRITICAL"
    default: "UNKNOWN,LOW,MEDIUM,HIGH,CRITICAL"
    type: string
  SOFT_FAIL:
    description: "Do not return an error code if there are failed checks"
    default: true
    type: boolean
  IMAGE_TAG:
    description: "Docker image tag (for build)"
    default: ""
    type: string
  IMAGE:
    description: "Docker image base name (for build)"
    default: ""
    type: string
executor: executor
steps:
  - checkout
  - attach_workspace:
      at: /tmp/workspace
  - container-scan:
      IMAGE_NAME: <<parameters.IMAGE_NAME>>
      TAG: <<parameters.TAG>>
      IMAGE: <<parameters.IMAGE>>
      IMAGE_TAG: <<parameters.IMAGE_TAG>>
      SEVERITY: <<parameters.SEVERITY>>
      SOFT_FAIL: <<parameters.SOFT_FAIL>>
      IMAGE_TAR: <<parameters.IMAGE_TAR>>